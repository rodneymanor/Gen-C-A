var scopeCache = new WeakMap();

/**
 * Adjusted from ESLint `https://github.com/eslint/eslint/blob/main/lib/source-code/source-code.js`
 * because the `sourceCode.getScope()` method only exists in newer versions of ESLint and we want to
 * support older ones.
 */
function getScope(_ref) {
  var currentNode = _ref.node,
    sourceCode = _ref.sourceCode;
  // check cache first
  var cachedScope = scopeCache.get(currentNode);
  if (cachedScope) {
    return cachedScope;
  }

  // On Program node, get the outermost scope to avoid return Node.js special function scope or ES modules scope.
  var inner = currentNode.type !== 'Program';
  var scopeManager = sourceCode.scopeManager;
  for (var node = currentNode; node; node = node.parent) {
    var scope = scopeManager.acquire(node, inner);
    if (scope) {
      if (scope.type === 'function-expression-name') {
        scopeCache.set(currentNode, scope.childScopes[0]);
        return scope.childScopes[0];
      }
      scopeCache.set(currentNode, scope);
      return scope;
    }
  }
  scopeCache.set(currentNode, scopeManager.scopes[0]);
  return scopeManager.scopes[0];
}
export function findVariable(_ref2) {
  var identifier = _ref2.identifier,
    sourceCode = _ref2.sourceCode;
  var scope = getScope({
    node: identifier,
    sourceCode: sourceCode
  });
  while (scope) {
    var variable = scope.set.get(identifier.name);
    if (variable) {
      return variable;
    }
    scope = scope.upper;
  }
  return null;
}