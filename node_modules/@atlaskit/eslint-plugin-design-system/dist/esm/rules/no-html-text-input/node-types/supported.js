import { isNodeOfType } from 'eslint-codemod-utils';
import * as ast from '../../../ast-nodes';
var supportedElements = [{
  name: 'input',
  attributes: [{
    name: 'type',
    values: ['text'],
    canBeUndefined: true
  }]
}];

/**
 * Determines if the given JSX element is a supported element to lint with this rule.
 */
export function isSupportedForLint(jsxNode, elementName) {
  if (!isNodeOfType(jsxNode, 'JSXElement')) {
    return false;
  }

  // Allow passing in the element name because the jsxNode doesn't
  // represent the element name with styled components
  var elName = elementName || ast.JSXElement.getName(jsxNode);
  if (!elName) {
    return false;
  }

  // Only check native HTML elements, not components
  if (elName[0] !== elName[0].toLowerCase()) {
    return false;
  }
  var supportedElement = supportedElements.find(function (_ref) {
    var name = _ref.name;
    return name === elName;
  });
  if (!supportedElement) {
    supportedElement = supportedElements.find(function (_ref2) {
      var name = _ref2.name;
      return name === '*';
    });
  }
  if (!supportedElement) {
    return false;
  }

  // Check if the element has any attributes that are not supported
  var attributes = ast.JSXElement.getAttributes(jsxNode);
  if (supportedElement.attributes &&
  // If not every attribute resolves to `true`
  !supportedElement.attributes.every(function (_ref3) {
    var name = _ref3.name,
      values = _ref3.values,
      canBeUndefined = _ref3.canBeUndefined;
    // If it can be an undefined prop
    if (canBeUndefined) {
      // Search attributes for `name`
      var foundAttribute = attributes.find(function (attr) {
        return isNodeOfType(attr, 'JSXAttribute') && attr.name.name === name;
      });
      // If we didn't find that attribute, then it should be linted
      if (!foundAttribute) {
        return true;
      }
    }

    // If we did find the attribute with a matching name, then check if one of
    // it's values matches
    return attributes.some(function (attribute) {
      // Don't lint spreads
      if (attribute.type === 'JSXSpreadAttribute') {
        return false;
      }
      var isMatchingName = attribute.name.name === name;
      var isMatchingValues = values && attribute.value && attribute.value.type === 'Literal' && typeof attribute.value.value === 'string' && (values === null || values === void 0 ? void 0 : values.includes(attribute.value.value));

      // If one of our values match the attribute's value, lint it
      return isMatchingName && isMatchingValues;
    });
  })) {
    return false;
  }
  return true;
}